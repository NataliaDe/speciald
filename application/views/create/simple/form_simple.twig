{% extends 'layout.twig' %}

{% block title %}{{title}}{% endblock %}

{% block content %}
    <!-- content -->


    {%include '/parts/bread_crumb.twig'%}
    <br> <br>


    <form role="form" id="createSimple" method="POST" action="{{base_url('/dones/simple_save')}}" enctype=multipart/form-data>

        {%if is_edit_dones is defined and dones is defined and dones.is_see == 1  %}

            <fieldset disabled>
            {%endif%}

            <input type="hidden" name="type_sd" value="{{type_sd}}">


            {%include '/create/dones_header_block.twig'%}

            <div class="accordion">
                <dl>
                    <dt class="dt-class">
                        <a  href="#accordion1" aria-expanded="true" aria-controls="accordion1" class="accordion-title accordionTitle js-accordionTrigger custom-a is-collapsed is-expanded accordion-a-official" >Специальная служебная информация</a>
                    </dt>
                    <dd class="accordion-content accordionItem is-expanded animateIn accordion-content-official" id="accordion1" aria-hidden="false">
                        {%include '/create/standart/official_block.twig'%}
                    </dd>
                    <dt class="dt-class">
                        <a style="background-color:#428bca; color: white;border-color: #428bca; " href="#accordion2" aria-expanded="false" aria-controls="accordion2" class="accordion-title accordionTitle js-accordionTrigger custom-a is-collapsed is-expanded">
                            Текст специального донесения (ручной набор данных)</a>
                    </dt>
                    <dd class="accordion-content accordionItem is-expanded animateIn" id="accordion2" aria-hidden="false">
                        <br>
                        {%include '/create/simple/blocks/date_msg.twig'%}

                        {%include '/create/standart/opening_block.twig'%}
                    </dd>
                </dl>

            </div>



            <div class="form-group col-md-12">
                <label for="is_test_sd" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
                <div class="checkbox checkbox-danger">
                    <input  type="checkbox" name="is_test_sd" value="1" id="is_test_sd" {%if is_edit_dones is defined and is_edit_dones == 1 and dones is defined and dones.is_test_sd == 1 %}checked{%endif%}>
                    <label for="is_test_sd" style="color:red">
                        Тестовое СД. После окончания тестирования ПС можно удалить.
                    </label>
                </div>
            </div>


            <center>
                {%if  dones.is_see == 1  %}

                {%else%}
                    <button type="submit" class="btn btn-danger">Сохранить</button>
                    <a href="{{base_url('/creator/catalog')}}"><button type="button" class="btn btn-secondary" >Отмена</button></a>
                {%endif%}

            </center>

            {%if is_edit_dones is defined and dones is defined and dones.is_see == 1  %}
            </fieldset>
        {%endif%}

        {%if is_edit_dones is defined and dones is defined and dones.is_see == 1  %}
            <center>
                <a href="{{base_url('/creator/catalog')}}"><button type="button" class="btn btn-secondary" >Отмена</button></a>
            </center>
        {%endif%}

    </form>


    <!-- .content -->

    {%include '/create/standart/modals/modal-media.twig'%}

{% endblock %}


{% block head %}
    <link rel="stylesheet" href="{{ base_url('/assets/accordion/style.css') }}">
    <link rel="stylesheet" href="{{ base_url('/assets/css/sb-admin-2.css') }}">
    <link rel="stylesheet" href="{{ base_url('/assets/css/timer.css') }}">
    <link href="{{ base_url('/assets/daterangepicker/daterangepicker.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="{{ base_url('assets/datatables/jquery.dataTables.css') }}">
    <link rel="stylesheet" href="{{ base_url('/assets/css/media.css') }}">

{% endblock %}

{% block footer %}
    <script src="{{ base_url('/assets/accordion/index.js')}}"></script>
    <script type="text/javascript" src="{{ base_url('assets/js/jquery.downCount.js') }}"></script>
    <script src="{{ base_url('/assets/js/mask/jquery.maskedinput.min.js')}}"></script>
    <script type="text/javascript"
    src="{{ base_url('assets/daterangepicker/moment.min.js') }}"></script>
    <script type="text/javascript"
    src="{{ base_url('assets/daterangepicker/daterangepicker.js') }}"></script>

    <script src="{{ base_url('/assets/js/manual_datetimepicker.js')}}"></script>


    <script src="{{ base_url('/assets/js/form-standart/media.js')}}"></script>

    {%if is_edit_dones is not defined  %}
        <script src="{{ base_url('/assets/js/timer.js')}}"></script>

    {%endif%}



    <script>

        jQuery("#lat_id").mask("99.999999");//долгота
        jQuery("#long_id").mask("99.999999");//широта

        $(document).ready(function () {
            $('.select2-select').select2({
                placeholder: "Выберите из списка",
                // allowClear: true,
                "language": {
                    "noResults": function () {
                        return "Ничего не найдено";
                    }
                }
            });


        });



        $('body').on('input change keyup', '.date-time-sec-cal', function (e) {
            setPreviewData();
        });


        $('body').on('click', '.daterangepicker .applyBtn ', function (e) {
            setPreviewData();
        });


        $('body').on('change', '#lat_id', function (e) {
            setPreviewData();
        });


        $('body').on('change', '#long_id', function (e) {
            setPreviewData();


        });



        $('body').on('input change keyup', '#opening_description_id', function (e) {
            setPreviewData();

        });


        function setPreviewData() {


            var date = $('.date-time-sec-cal').val();
            var time = $('.date-time-sec-cal').val();
            var lat = $('#lat_id').val();
            var long = $('#long_id').val();
            var descr = $("#opening_description_id").val();


            var new_date = '';
            var new_time = '';
            var new_lat = '';
            var new_long = '';
            var new_coord = '';
            var new_descr = '';


            var arr_date = date.split(' ');

            if (date !== '') {
                new_date = arr_date[0] + ' года ';
            }

            if (time !== '') {

                var arr_time = arr_date[1].split(':');
                new_time = 'в ' + arr_time[0] + ':' + arr_time[1] + ' ';
            }



            new_coord = ' (' + lat + ', ' + long + ').';

            if (lat === '' && long === '') {
                new_coord = ' (нет координат).';
            }



            if (descr !== '') {
                new_descr = descr.replace(/\r?\n/g, '<br />');

                var arr_new_descr = new_descr.split('<br />');
                arr_new_descr[0] = arr_new_descr[0] + '' + new_coord;
                var arr_new_descr_str = arr_new_descr.join('<br />');
            } else {
                var arr_new_descr_str = new_coord;
            }

            $('#preview-simple-block').html('<b><u>Предпросмотр:</u></b><br>' + new_date + '' + new_time + '' + arr_new_descr_str);


        }

    </script>




{% endblock %}

